<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: Calibration</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('dd/d61/refDetectorsMUONMCHCalibration.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Calibration </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>MCH Calibration</h1>
<h2>Calibration type(s)</h2>
<p>So far MCH has only one calibration : the bad channel map.</p>
<p>This bad channel map is computed from pedestal data taken in special calibration runs, where the actual zero suppression is disabled in the electronics, so we readout complete information from the detector and can compute the mean and sigma of the pedestal values for all the channels.</p>
<p>Once the pedestal means and sigmas are known, we declare some channels bad if their pedestal mean and/or sigma are outside of some limits (defined in <code>BadChannelCalibratorParam</code>, which is a <code>ConfigurableParam</code>, hence settable from the command-line using the <code>--configKeyValues</code> option of the workflow).</p>
<h2>Calibration object(s)</h2>
<p>Two objects are produced by the calibration workflow (see below), distinguishable by the subspec they use :</p>
<ul>
<li>subspec 0 : a <code>std::vector</code> of <code>DsChannelId</code> that should end up in the regular CCDB. That object is/will be used for filtering digits during the reconstruction/simulation phase</li>
<li>subspec 1 : a <code>TObjString</code> wrapping a CSV containing the same information as above, that should end up in the DCS CDB. That object is meant to be used by DCS to configure the electronics.</li>
</ul>
<h2>Calibration workflow</h2>
<p>The calibration device executable is named <code>o2-calibration-mch-badchannel-calib-workflow</code> (spec name is <code>mch-badchannel-calibrator</code>). It can be configured using the <a href="../../include/MCHCalibration/BadChannelCalibratorParam.h">MCHBadChannelCalibratorParam</a> keys.</p>
<p>By default the bad channel calibrator only computes the output object at the end-of-stream (EOS). To alleviate possible issues with EOS not working properly, one can set special key options to also compute after a given fraction of channels have reached enough statistics.</p>
<p>For instance (see also <code>test/example-mch-pedestal-calibration.sh</code>) :</p>
<div class="fragment"><div class="line">o2-raw-tf-reader-workflow --max-tf 10 --input-data \</div>
<div class="line">  $HOME/alice/data/ped/StfBuilder-CH9R-pedestals-ul-with_gnd-without_HV-20210617 | \</div>
<div class="line">o2-mch-pedestal-decoding-workflow | \</div>
<div class="line">o2-calibration-mch-badchannel-calib-workflow \</div>
<div class="line">  --configKeyValues=&quot;MCHBadChannelCalibratorParam.minRequiredNofEntriesPerChannel=100;MCHBadChannelCalibratorParam.minRequiredCalibratedFraction=0.5;MCHBadChannelCalibratorParam.onlyAtEndOfStream=false&quot; | \</div>
<div class="line">o2-calibration-ccdb-populator-workflow \</div>
<div class="line">  --ccdb-path http://localhost:6464 \</div>
<div class="line">  --sspec-min 0 --sspec-max 0 | \</div>
<div class="line">o2-calibration-ccdb-populator-workflow \</div>
<div class="line">  --ccdb-path localhost:8484 --sspec-max 1 --sspec-min 1 --name-extention dcs | \</div>
<div class="line">o2-qc \</div>
<div class="line">  --config json://$HOME/cernbox/o2muon/qc/qc_configs/qc-pedestal.json | \</div>
<div class="line">o2-dpl-run \</div>
<div class="line">  --run -b \ </div>
<div class="line">&gt; ped-calib.log</div>
</div><!-- fragment --><p>In that example we instruct the calibrator to compute (and forward to the CCDB populator) the bad channel map when at least 50% of the channels have more than 100 entries. Note that in this case, and depending of the run duration, several objects might be uploaded, while in the "normal" case (<code>onlyAtEndOfStream=true</code>) there will be only one (or two, if two populators are used) object will be uploaded. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d0/d2f/refDetectors.html">Module &#39;Detectors&#39;</a></li><li class="navelem"><a class="el" href="../../d4/dff/refDetectorsMUON.html">MUON</a></li><li class="navelem"><a class="el" href="../../d0/daf/refDetectorsMUONMCH.html">MCH</a></li>
    <li class="footer">Generated on Wed Mar 9 2022 06:08:46 for Project by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
